# AgentMarket – מערכת ניתוח שוק יומי לחוזים עתידיים

ברוכים הבאים לפרויקט **AgentMarket**. מערכת זו נבנתה כדי לספק ניתוח שוק יומי לחוזים עתידיים על סמך איסוף חדשות, מגמות ונתונים היסטוריים, חישוב ציוני סנטימנט ומאקרו, שילובם במודל למידת מכונה והצגת החלטות מסחר בדשבורד אינטרקטיבי. להלן הסבר על מבנה הפרויקט והזרימה של התהליכים השונים.

## מבנה התיקיות והקבצים

להלן פירוט ההיררכיה של הפרויקט ברמה גבוהה. כל תיקיה או קובץ מרכזי מלווהה בהסבר קצר על תפקידו:

* **`Backtest_projects/`** – מודולים ל‑Backtesting וחקר נתונים. כאן נמצאים סקריפטים לניתוח תכנים (`content_analyz.py`) ולשליפה אסינכרונית של חדשות (`fetch_news_rss.py`), כן קובץ `gpt_raw_responses.txt` שמכיל פלטים גולמיים של קריאות GPT לצורך בדיקות.

* **`ai_analysis/`** – מכיל את `openai_client.py`, מחלקה העוטפת את קריאות OpenAI לצורך ניתוח טקסטים ושירותי NLP המשמשים את מודולי הסנטימנט.

* **`analysis_results/`** – תיקיה לאחסון תוצאות עיבוד וניתוח חדשות. לדוגמה, הקובץ `daily_scores_2025-06-11.json` מציג תוצאות ניתוח יומי לרוחב מדדים שונים (תאריך, מקור חדשות, כותרת, ניתוח, ציון השפעה והמלצה).

* **`market_dashboard/`** – יישום הדשבורד שנכתב ב‑Streamlit להצגת החלטות המסחר:
  * `app.py` – נקודת הכניסה הראשית לדשבורד.
  * `config.yaml` – קובץ קונפיגורציה לפרמטרים כלליים של הדשבורד.
  * `data/` – נתוני בסיס שמזינים את הדשבורד (`alerts.json`, `scores.json`).
  * `logs/` – קבצי יומן להפעלת הדשבורד (`score_log.csv`, `alerts_log.txt`, `error_log.txt`).
  * `modules/` – מודולים עסקיים של הדשבורד ( טיפול בהתרויות, קריאת קוןפיג, טעינת נתונים).
  * `pages/` – עמודי הדשבורד המפורטים: `dashboard.py` (עמוד ראשי עם החלטה יומית ונתונים היסטוריים), `ml_learning.py` (עמוד למידת מכונה), `alerts_page.py`, `settings.py`, `system_info.py` ועוד.

* **`rss_feeds/`** – מכיל את `feeds_list.py`, רשימת מקורות RSS שמהם נאספות חדשות ומאמרים לצורך ניתוח סנטימנט ומאקרו.

* **`scores_news/`** – הליבה של חישובי הציונים והמודל:
  * `cat_scores/` – מודולים לחישוב ציונים לפי קטגוריות: סנטימנט (`sentiment_score.py`), מאקרו (`macro_score.py`), אג ח (`bonds_score.py`), חוזים עתידיים ו VIX (`futures_vix_score.py`), מדד MES (`mes_score.py`), ומגזרים (`sectors_score.py`). הקובץ `final_score.py` מריץ את כולם, מחשב משקלות ומשלב אותם לציון סופי.
  * `config/` – קבצי תצורה: משקלים (`weights.json`), ספי החלטה (`thresholds.json`), מילות מפתח לסנטימנט, קובץ `MES_data.csv` עם נתוני MES היסטוריים ויומן ציונים (`score_log.csv`).
  * `data_sources/` – סקריפטים לשליפת נתונים בזמן אמת: נתוני א גח (`fetch_bonds_data.py`), נתוני מאקרו (`fetch_macro_data.py`), נתוני MES (`fetch_mes_data.py`), חדשות (`fetch_news_rss.py`), נתוני מגזרים (`fetch_sector_data.py`), נתוני VIX ו DXY עוד.
  * `ml_model/` – רכיבי למידת המכונה: הקובץ `model.pkl` הוא המודל המאומן שמנבא כיוון שוק על סמך הציונים, `merged_scores_mes.csv` מכיל טבלת אימון עם ציונים והיסטורית שינוים ב MES, `train_model.py` מאמן מודל חדש, ו `performance_tracker.py` בודק את איכות החיזוי ומעדך משקלים דינמית.
  * `tests/` – בדיקות יחידה לווידוא תקינות הפונקציות (לדוגמה `test_final_score_integration.py`).
  * `utils/` – עזרים שונים כמו מטמן (`cache.py`) וניקוי טקסטים (`cleaning.py`).

* **`utils/`** – פונקציות עזר כלליות לפרויקט, כלל `helpers.py` ו `whatsapp_alerts.py` לשליחת התרועות ב‑WhatsApp.

* קבצים נוספים בשורש:
  * **`main.py`** – קובץ הדגמה או בדיקה ראשית להרצת חלקים שונים בפרויקט.
  * **`tester.py`** – סקריפט עזר לבחינת הרצת מודולים באופן ממוקד.
  * **`daily_scores_2025-06-11.json`** – עותק של תוצאות ניתוח יומי, דומה לקבצים המופיעים ב־`analysis_results/`.

## איך עובד ה‑Workflow?

1. **איסוף נתונים** – המערכת מאזינה למקורות RSS ומקורות כלכליים (רשומים ב־`rss_feeds/feeds_list.py`). מודולי `scores_news/data_sources` שולפים נתוני מאקרו, אג ח, MES ומגזרים, ומעדכן קבצים או לוגים מתאימים.

2. **ניתוח סנטימנט ומאקרו** – טקסטים וחדשות עוברים תהליכי ניקוי וניתוח סנטימנט ב `sentiment_score.py` ואנליזה כלכלית ב `macro_score.py`. החישובים משתמשים ב OpenAI דרך `ai_analysis/openai_client.py` ובמילון מילות מפתח המוגד ב `sentiment_keywords.json`.

3. **חישוב ציונים לכל קטגוריה** – כל מודול ב `cat_scores` מחזיר ציון מספרי (0–100) והסבר מילולי. למשל, מודול האג ח מחשב ציון לפי עקום התשואות, ומודול ה MES מחשב ציון על סמך שינוי באינדקס.

4. **ציון סופי והחלטת מסחר** – `final_score.py` מריץ את כל מודולי הציונים, קורא את משקלי הקטגוריות (`weights.json`), מחבר את הציונים לממוצע משוקלל ומחליט על המלצת LONG/SHORT/NEUTRAL לפי סף סיכום (`thresholds.json`). התוצאות נשמרות לקובץ יומן (`score_log.csv`), הכולל גם נתונים כמו שינוי יומים באחוזים, מחיר פתיחה/סגירה וכיוון.

5. **למידת מכונה** – `scores_news/ml_model/train_model.py` מאמן מודל RandomForest על בסיס טבלת ציונים היסטורית (`merged_scores_mes.csv`) ועל פי התוויות של כיוון השוק. המודל המאומן נשמר ב `model.pkl`. בעת הפעלת הדשבורד, המודל נטען ומנבא את המלצה היומית על סמך הציונים העדכוניים.

6. **עקביות ושיפור משקלים** – סקריפט `performance_tracker.py` משווה בסוף כל יום בין כיוון השוק בפעל לבין תחזית המודל, מתעד את התוצאה ב־`ml_performance_log.csv` ומחשב משקלים חדשים לקטגוריות על סמך הצלחות קודמות. משקלים אלו מעודכנים ב־`weights.json` כדי לשפר את המערכת באופן אדהבי.

7. **הדשבורד** – באמצעות `market_dashboard/app.py` ניתן להצי9 בדפדפן את כל הנתונים והחלטות המסחר. הדשבורד מציג את הציון הסופי, ציוניי הקטגוריות, גרף מגמות, השווה ל‏MES וגם מאפשר להריץ ידנית חזיה יומית או לבדוק את הצלחת המודל אחר סגירת השוק.

## הערות שימוש

* על מנת שהקוד ירוץ בצורה ניידת ( לוקלית או בענן) מומלץ לעדכן נתיבים קשיחים בקבצים כמ `final_score.py`, `performance_tracker.py` ו `dashboard.py` כך שישתמשו בנתיבים יחסיים על בסיס מקום הפרויקט (`Path(__file__)`).
* מומלץ להריץ תהליך יומי של `final_score.py` בשעות הבוקר ולשמור את הפלט ל־`score_log.csv`, ובהמשך היום לעדכן את הצלחת המודל דרך `performance_tracker.py`.
* כדי לצפות בדשבורד יש להתקין את הספריות הנדרשות (`streamlit`, `matplotlib`, `seaborn`, `scikit-learn` ועוד) ולהריץ `streamlit run market_dashboard/app.py` מתוך תיקיית הפרויקט.

המסמך הזה נועד להקל על הכרות מהיר עם הקוד ועם זרימת העבודה של AgentMarket. בהצלחה!
